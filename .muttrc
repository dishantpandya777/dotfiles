# Sven's draconian header weeding
ignore *
unignore from date subject to cc
unignore organization organisation x-mailer: x-newsreader: x-mailing-list:
unignore posted-to:

# set all of our emails to have flowing text, accommodating for mobile devices
set text_flowed=yes

# use my standard configuration of vim that is used for all of text editing
set editor="nvim +/^$ ++1"
# set editor="nvim"

# edit the emails in a local tmp/ directory, thus ensuring that I do not lose work when computer crashes
set tmpdir="/home/gkapfham/.mutt/tmp"

# explicitly specify the mailboxes to display in the sidebar
mailboxes imaps://imap.gmail.com:993/INBOX imaps://imap.gmail.com:993/chair2017 imaps://imap.gmail.com:993/dbtest imaps://imap.gmail.com:993/kanonizo imaps://imap.gmail.com:993/redecheck imaps://imap.gmail.com:993/research imaps://imap.gmail.com:993/reviews2017

set sidebar_visible
set sidebar_format = "%B%?F? [%F]?%* %?N?%N/?%S"
set mail_check_stats

bind index,pager \cp sidebar-prev
bind index,pager \cn sidebar-next
bind index,pager \co sidebar-open

set abort_noattach="ask-yes"

# make it possible to edit the headers in the (n)vim
set edit_headers=yes

# Mutt Colors for Black Background
color   hdrdefault   color172               default
color   quoted       color13                default
color   signature    color3                 default
color   attachment   color12                default
color   message      color246               default
color   error        color246               default
color   indicator    color15                default
color   status       color246               default
color   tree         color8                 default
color   normal       color246               default
color   markers      color237               default
color   search       white                  default
color   tilde        white                  default
color   index        color246               default ~F
color   index        color246               default "~N|~O"
color progress white color237

#set signature='~/.signature'
#set post_indent_string="--"       # Footer (after quotes, before signature).

set mbox_type=Maildir
set confirmappend=no     # Confirm when appending messages to an existing mailbox?
set pager_index_lines=12  # Show 5 message headers from your message index above an email you are reading
set markers          # mark wrapped lines of text in the pager with a +
set smart_wrap       # Don't wrap mid-word
set pager_context=5  # Retain 5 lines of previous page when scrolling.
set pager_stop = yes

set save_name=yes
my_hdr From: "Gregory M. Kapfhammer" <gkapfham@allegheny.edu>
my_hdr Bcc: "Gregory M. Kapfhammer" <gkapfham@gmail.com>
hdr_order From Date: From: To: Cc: Subject:
set move=no
auto_view text/html text/enriched application/postscript image/gif

# quote msg when replying
set include

# display the sort order
set sort=threads
set implicit_autoview
set beep=no

# SSL hardening
set ssl_force_tls=yes
set ssl_starttls=yes
set ssl_verify_dates=yes
set ssl_verify_host=yes

# set up the imap settings for my INBOX and my Drafts folders
set folder = "imaps://imap.gmail.com:993"
set spoolfile = "+INBOX"
set postponed = "+[Gmail]/Drafts"
set trash = "+[Google]/Trash"

set my_foo_pass="`gpg --quiet --for-your-eyes-only -d ~/.mutt/password.gpg`"
set imap_user = "gkapfham@allegheny.edu"
set imap_pass=$my_foo_pass
set smtp_pass=$my_foo_pass
set smtp_url = "smtp://gkapfham@allegheny.edu@smtp.gmail.com:587/"

# allow mutt to performing caching as a way to improve performance
# set header_cache=~/.mutt/cache/headers
set message_cachedir=~/.mutt/cache/bodies
set certificate_file=~/.mutt/certificates

set imap_keepalive=100

set timeout=5    # mutt 'presses' (like) a key for you (while you're idle)
                  # each x sec to trigger the thing below
set mail_check=5  # mutt checks for new mails on every keystroke
                  # but not more often then once in 5 seconds
set beep_new      # beep on new messages in the mailboxes

# use an aliases file to automatically save all of email addresses of emails that I read
set alias_file = '~/.mutt/aliases.txt'
source $alias_file

# Gmail-style keyboard shortcuts
bind editor <space> noop

# Gmail-style keyboard shortcuts
bind index g noop
macro index ga "<change-folder>=[Gmail]/All Mail<enter>" "Go to all mail"
macro index gd "<change-folder>=[Gmail]/Drafts<enter>" "Go to drafts"
macro index gi "<change-folder>=INBOX<enter>" "Go to inbox"
macro index gs "<change-folder>=[Gmail]/Starred<enter>" "Go to starred messages"
macro index gt "<change-folder>=[Gmail]/Trash<enter>" "Go to trash"
macro index go "<change-folder>=[Gmail]/Sent Mail<enter>" "Go to outbox"

# macro index ^n "<change-folder>=[Gmail]/Sent Mail<enter>" "Go to drafts"
# macro index ^d "<change-folder>=[Gmail]/Drafts<enter>" "Go to drafts"
# macro index ^i "<change-folder>=INBOX<enter>" "Go to inbox"
# macro index ^s "<change-folder>=[Gmail]/Starred<enter>" "Go to starred messages"
# macro index ^t "<change-folder>=[Gmail]/Trash<enter>" "Go to trash"

# macro index,pager d "<save-message>=[Gmail]/Trash<enter><enter>" "Trash"
# macro index,pager y "<save-message>=[Gmail]/All Mail<enter><enter>" "Archive"

# set up a group reply key binding to make it easy to reply-all (I use this a lot)
bind index G group-reply
set followup_to=yes

# install a display_filter so that I can capture all of my email headers for aliases
set display_filter = '$HOME/.mutt/aliases.sh'

# add features for the goobook; note that you can run this type of query with CTRL-t
set query_command="goobook query '%s'"
macro index,pager a "<pipe-message>goobook add<return>" "add the sender address to Google contacts"

#### muttprint:
set print_command="muttprint"
set print_split

# Dump all headers
macro index p "<display-toggle-weed> <print-message> <display-toggle-weed> <exit>"
macro pager p "<display-toggle-weed> <print-message> <display-toggle-weed>"

# macro pager \cb <pipe-entry>'w3m'<enter> 'Follow links in w3m'
macro index,pager \cb <pipe-entry>'urlview'<enter> 'Follow links with urlview'
macro attach,compose \cb <pipe-entry>'urlview'<enter> 'Follow links with urlview'

# macro index,pager \cb "<pipe-message> urlscan<Enter>" "call urlscan to extract URLs out of a message"
# macro attach,compose \cb "<pipe-entry> urlscan<Enter>" "call urlscan to extract URLs out of a message"
# macro index,pager \cB ": unset wait_key; set pipe_decode\n|urlview\n: set wait_key; unset pipe_decode\n" "call w3m to extract URLs out of a message"

# No confirmation before printing
set print="yes"
